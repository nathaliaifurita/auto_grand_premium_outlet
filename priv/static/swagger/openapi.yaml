openapi: 3.0.3

info:
  title: Auto Grand Premium Outlet API
  version: "1.0.0"
  description: API para gestÃ£o de veÃ­culos, vendas e pagamentos

servers:
  - url: http://localhost:4000/api

tags:
  - name: Vehicles
  - name: Sales
  - name: Payments

paths:
  /vehicles/available:
    get:
      tags: [Vehicles]
      summary: List available vehicles
      description: Returns a list of available vehicles ordered by price
      responses:
        '200':
          $ref: '#/components/responses/VehicleListResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /vehicles:
    post:
      tags: [Vehicles]
      summary: Create a new vehicle
      requestBody:
        $ref: '#/components/requestBodies/VehicleCreate'
      responses:
        '201':
          $ref: '#/components/responses/VehicleResponse'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /vehicles/sold:
    get:
      tags: [Vehicles]
      summary: List sold vehicles
      description: Returns a list of sold vehicles ordered by price
      responses:
        '200':
          $ref: '#/components/responses/VehicleListResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /vehicles/{id}:
    get:
      tags: [Vehicles]
      summary: Get vehicle by ID
      parameters:
        - $ref: '#/components/parameters/VehicleId'
      responses:
        '200':
          $ref: '#/components/responses/VehicleResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags: [Vehicles]
      summary: Update vehicle
      parameters:
        - $ref: '#/components/parameters/VehicleId'
      requestBody:
        $ref: '#/components/requestBodies/VehicleUpdate'
      responses:
        '200':
          $ref: '#/components/responses/VehicleResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /sales:
    post:
      tags: [Sales]
      summary: Create a new sale
      requestBody:
        $ref: '#/components/requestBodies/SaleCreate'
      responses:
        '201':
          $ref: '#/components/responses/SaleResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /sales/{sale_id}/complete:
    put:
      tags: [Sales]
      summary: Complete a sale
      parameters:
        - $ref: '#/components/parameters/SaleId'
      responses:
        '200':
          $ref: '#/components/responses/SaleResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /sales/{sale_id}/cancel:
    put:
      tags: [Sales]
      summary: Cancel a sale
      parameters:
        - $ref: '#/components/parameters/SaleId'
      responses:
        '200':
          $ref: '#/components/responses/SaleResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments:
    post:
      tags: [Payments]
      summary: Create payment
      requestBody:
        $ref: '#/components/requestBodies/PaymentCreate'
      responses:
        '201':
          $ref: '#/components/responses/PaymentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/{payment_code}/confirm:
    put:
      tags: [Payments]
      summary: Confirm payment
      parameters:
        - $ref: '#/components/parameters/PaymentCode'
      responses:
        '200':
          $ref: '#/components/responses/PaymentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/{payment_code}/cancel:
    put:
      tags: [Payments]
      summary: Cancel payment
      parameters:
        - $ref: '#/components/parameters/PaymentCode'
      responses:
        '200':
          $ref: '#/components/responses/PaymentResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:

  ## ðŸ”¹ PARAMETERS
  parameters:
    VehicleId:
      name: id
      in: path
      required: true
      schema:
        type: string
        example: "135"

    SaleId:
      name: sale_id
      in: path
      required: true
      schema:
        type: string
        example: "sale_123"

    PaymentCode:
      name: payment_code
      in: path
      required: true
      schema:
        type: string
        example: "pay_456"

  ## ðŸ”¹ REQUEST BODIES
  requestBodies:
    VehicleCreate:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/VehicleInput'
          example:
            brand: "Toyota"
            model: "Corolla"
            year: 2022
            color: "Preto"
            price: 120000
            license_plate: "ABC1D23"

    VehicleUpdate:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/VehicleInput'
          example:
            brand: "Toyota"
            model: "Corolla"
            year: 2022
            color: "Branco"
            price: 130000
            license_plate: "ABC1D23"

    SaleCreate:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/SaleInput'
          example:
            vehicle_id: "135"
            buyer_cpf: "12345678901"

    PaymentCreate:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PaymentInput'
          example:
            sale_id: "sale_123"
            amount: 120000

  ## ðŸ”¹ RESPONSES
  responses:
    VehicleResponse:
      description: Vehicle data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Vehicle'
          examples:
            available_vehicle:
              summary: Available vehicle
              value:
                id: "135"
                brand: "Toyota"
                model: "Corolla"
                year: 2022
                color: "Preto"
                price: 120000
                license_plate: "ABC1D23"
                status: "available"
                sold_at: null
            sold_vehicle:
              summary: Sold vehicle
              value:
                id: "136"
                brand: "Honda"
                model: "Civic"
                year: 2021
                color: "Branco"
                price: 90000
                license_plate: "XYZ2A34"
                status: "sold"
                sold_at: "2024-01-15T10:30:00Z"

    VehicleListResponse:
      description: List of vehicles
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Vehicle'
          example:
            - id: "135"
              brand: "Toyota"
              model: "Corolla"
              year: 2022
              color: "Preto"
              price: 120000
              license_plate: "ABC1D23"
              status: "available"
              sold_at: null
            - id: "136"
              brand: "Honda"
              model: "Civic"
              year: 2021
              color: "Branco"
              price: 90000
              license_plate: "XYZ2A34"
              status: "available"
              sold_at: null

    SaleResponse:
      description: Sale data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Sale'
          examples:
            initiated_sale:
              summary: Initiated sale
              value:
                id: "sale_123"
                vehicle_id: "135"
                buyer_cpf: "12345678901"
                status: "initiated"
                inserted_at: "2024-01-15T10:00:00Z"
                updated_at: null
            completed_sale:
              summary: Completed sale
              value:
                id: "sale_123"
                vehicle_id: "135"
                buyer_cpf: "12345678901"
                status: "completed"
                inserted_at: "2024-01-15T10:00:00Z"
                updated_at: "2024-01-15T10:30:00Z"

    PaymentResponse:
      description: Payment data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Payment'
          examples:
            in_process_payment:
              summary: Payment in process
              value:
                id: "pay_123"
                payment_code: "pay_456"
                amount: 120000
                sale_id: "sale_123"
                status: "in_process"
                inserted_at: "2024-01-15T10:00:00Z"
            paid_payment:
              summary: Paid payment
              value:
                id: "pay_123"
                payment_code: "pay_456"
                amount: 120000
                sale_id: "sale_123"
                status: "paid"
                inserted_at: "2024-01-15T10:00:00Z"

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "validation_error"
            message: "Invalid price"

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "not_found"
            message: "Resource not found"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "internal_server_error"
            message: "An unexpected error occurred"

  ## ðŸ”¹ SCHEMAS
  schemas:
    Vehicle:
      type: object
      required: [id, brand, model, year, color, price, license_plate, status]
      properties:
        id:
          type: string
          example: "135"
        brand:
          type: string
          example: "Toyota"
        model:
          type: string
          example: "Corolla"
        year:
          type: integer
          example: 2022
        color:
          type: string
          example: "Preto"
        price:
          type: number
          example: 120000
        license_plate:
          type: string
          example: "ABC1D23"
        status:
          type: string
          enum: [available, sold]
          example: "available"
        sold_at:
          type: string
          format: date-time
          nullable: true
          example: null
      example:
        id: "135"
        brand: "Toyota"
        model: "Corolla"
        year: 2022
        color: "Preto"
        price: 120000
        license_plate: "ABC1D23"
        status: "available"
        sold_at: null

    VehicleInput:
      type: object
      required: [brand, model, year, color, price, license_plate]
      properties:
        brand:
          type: string
          example: "Toyota"
        model:
          type: string
          example: "Corolla"
        year:
          type: integer
          example: 2022
        color:
          type: string
          example: "Preto"
        price:
          type: number
          example: 120000
        license_plate:
          type: string
          example: "ABC1D23"
      example:
        brand: "Toyota"
        model: "Corolla"
        year: 2022
        color: "Preto"
        price: 120000
        license_plate: "ABC1D23"

    Sale:
      type: object
      required: [id, vehicle_id, buyer_cpf, status]
      properties:
        id:
          type: string
          example: "sale_123"
        vehicle_id:
          type: string
          example: "135"
        buyer_cpf:
          type: string
          example: "12345678901"
        status:
          type: string
          enum: [initiated, completed, cancelled]
          example: "initiated"
        inserted_at:
          type: string
          format: date-time
          example: "2024-01-15T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          nullable: true
          example: null
      example:
        id: "sale_123"
        vehicle_id: "135"
        buyer_cpf: "12345678901"
        status: "initiated"
        inserted_at: "2024-01-15T10:00:00Z"
        updated_at: null

    SaleInput:
      type: object
      required: [vehicle_id, buyer_cpf]
      properties:
        vehicle_id:
          type: string
          example: "135"
        buyer_cpf:
          type: string
          example: "12345678901"
      example:
        vehicle_id: "135"
        buyer_cpf: "12345678901"

    Payment:
      type: object
      required: [id, payment_code, amount, sale_id, status]
      properties:
        id:
          type: string
          example: "pay_123"
        payment_code:
          type: string
          example: "pay_456"
        amount:
          type: number
          example: 120000
        sale_id:
          type: string
          example: "sale_123"
        status:
          type: string
          enum: [paid, cancelled, in_process]
          example: "in_process"
        inserted_at:
          type: string
          format: date-time
          example: "2024-01-15T10:00:00Z"
      example:
        id: "pay_123"
        payment_code: "pay_456"
        amount: 120000
        sale_id: "sale_123"
        status: "in_process"
        inserted_at: "2024-01-15T10:00:00Z"

    PaymentInput:
      type: object
      required: [sale_id, amount]
      properties:
        sale_id:
          type: string
          example: "sale_123"
        amount:
          type: number
          example: 120000
      example:
        sale_id: "sale_123"
        amount: 120000

    Error:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
          example: "validation_error"
        message:
          type: string
          example: "Invalid price"
      example:
        error: "validation_error"
        message: "Invalid price"
